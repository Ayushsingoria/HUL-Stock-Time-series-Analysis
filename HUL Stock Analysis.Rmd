---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code.

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*.

```{r}

# # Required Packages
packages = c('quantmod','car','forecast','tseries','FinTS', 'rugarch','utf8','ggplot2')
# 
# # Install all Packages with Dependencies
#install.packages(packages, dependencies = TRUE)
# 
# # Load all Packages
lapply(packages, require, character.only = TRUE)

```

```{r}

getSymbols(Symbols = 'HINDUNILVR.NS', 
           src = 'yahoo', 
           from = as.Date('2018-01-01'), 
           to = as.Date('2023-12-31'),
           periodicity = 'daily')
HINDUNILVR_price = na.omit(HINDUNILVR.NS$HINDUNILVR.NS.Adjusted) # Adjusted Closing Price
class(HINDUNILVR_price) # xts (Time-Series) Object
HINDUNILVR_return = na.omit(diff(log(HINDUNILVR_price))); plot(HINDUNILVR_return)

```

Objective: To analyze the daily adjusted closing prices of HINDUNILVR.NS stock for the period spanning January 1, 2018, to December 31, 2023. To visualize the daily log returns of the stock and assess its potential volatility and patterns.

Analysis: The code first retrieves daily adjusted closing prices of HINDUNILVR.NS stock from Yahoo Finance for the specified period. It then prepares the data for analysis by: Removing any missing values (NAs). Extracting the adjusted closing price from the downloaded data. Confirming that the data is stored as an xts time-series object, which is tailored for time-series analysis in R. It calculates daily log returns, defined as the difference in the logarithm of prices between consecutive days. This is a common way to measure stock price changes in a way that accounts for compounding effects. It generates a visual plot of the daily log returns to inspect their distribution and potential patterns.

Interpretation Plot of the daily log returns of HINDUNILVR.NS stock from January 1, 2018, to December 31, 2023,

Distribution: The distribution of daily log returns appears to be approximately symmetrical around zero, with both positive and negative returns occurring with similar frequency. This suggests that the stock's price movements were not consistently biased towards up or down over the observed period.

Volatility: The presence of outliers on both sides of the distribution indicates that the stock's price experienced periods of higher volatility, where the price fluctuated more significantly than usual.

```{r}

#ADF test for Stationery

adf_test_jj = adf.test(HINDUNILVR_return); adf_test_jj

```

Analysis:

Objective: To assess the stationarity of the daily log returns of HINDUNILVR.NS stock using the Augmented Dickey-Fuller (ADF) test. Stationarity is a crucial property for many time-series analysis and forecasting techniques. Analysis:

The code applies the ADF test to the previously calculated daily log returns of the stock. It employs a lag order of 11, suggesting that the test incorporates information from the 11 prior time periods to account for potential serial correlation in the returns.

Interpretation: The ADF test results yield a Dickey-Fuller statistic of -11.087 and a p-value of 0.01. The p-value being less than the typical significance level of 0.05 leads to rejecting the null hypothesis of non-stationarity. This strongly supports the alternative hypothesis that the daily log returns of HINDUNILVR.NS stock are stationary over the observed period.

Implications: Stationarity implies that the statistical properties of the return series, such as mean and variance, remain relatively constant over time. This is a favorable condition for applying various time-series models for prediction or analysis. It suggests that the returns are not driven by persistent trends or long-term memory effects, making them more predictable using standard techniques.

```{r}

#Autocorrelation test
# Ljung-Box Test for Autocorrelation
lb_test_ds = Box.test(HINDUNILVR_return); lb_test_ds


```

Objective: To examine the presence of autocorrelation in the daily log returns of HINDUNILVR.NS stock using the Ljung-Box test.

Interpretation: The test results yield a chi-squared statistic of 5.6313 and a p-value of 0.01764. The p-value being less than the typical significance level of 0.05 suggests rejecting the null hypothesis of no autocorrelation. This implies that there is statistical evidence of autocorrelation in the daily log returns of the stock.

```{r}

#ACF and PACF

acf(HINDUNILVR_price) # ACF of JJ Series
pacf(HINDUNILVR_price) # PACF of JJ Series

acf(HINDUNILVR_return) # ACF of JJ Difference (Stationary) Series
pacf(HINDUNILVR_return) # PACF of JJ Difference (Stationary) Series


```

```{r}
#AutoArima
arma_pq_ds = auto.arima(HINDUNILVR_return); arma_pq_ds
arma_pq = auto.arima(HINDUNILVR_price); arma_pq

```

Objective: To identify appropriate ARIMA models for forecasting the daily log returns (HINDUNILVR_return) and daily adjusted closing prices (HINDUNILVR_price) of HINDUNILVR.NS stock.

Analysis: The code employs the auto.arima function to automatically select ARIMA models for both the log returns and price series based on statistical criteria like AIC and BIC.

Interpretation: For HINDUNILVR_return (Log Returns): The auto.arima function identified an ARIMA(0,0,1) model with a non-zero mean as the most suitable model.

This translates to: AR (Autoregressive): Order 0, meaning there are no autoregressive terms, implying past values don't directly influence future returns. I (Integrated): Order 0, indicating the series was already stationary (no differencing needed). MA (Moving Average): Order 1, meaning the current return is influenced by the error term (innovation) one period ago. The model coefficients indicate the estimated impact of the MA term and the non-zero mean on the log returns.

Coefficients: ma1: The coefficient value (-0.0663) signifies the estimated impact of the MA term on the log returns. Mean: Since the model suggests a non-zero mean, the coefficient associated with it (5e-04) represents a constant term added to the predicted values. sigma\^2: This value (0.0002107) represents the estimated variance of the error term in the model.

Other Statistics: Log likelihood: This value (-4164.98) indicates how well the model fits the data, with lower values generally suggesting a better fit. AIC (-8323.95), AICc (-8323.94), BIC (-8308.05): These metrics help compare different models for complexity and goodness of fit. Lower values are preferred.

Implication: The autoARIMA models provide a statistical framework to capture the underlying patterns in both daily returns and adjusted closing prices of HUL stock. These models can be used for forecasting future values, and the AIC, AICc, and BIC values help in model comparison.

Note: Interpretation of the coefficients and model selection details may require further analysis based on the specific context of the financial data.

```{r}

#Arima manuplation
arma13 = arima(HINDUNILVR_return, order = c(0, 0, 1)); arma13
ds_fpq = forecast(arma13, h = 500)
plot(ds_fpq)

```

Objective:

To fit an ARIMA(0,0,1) model to the daily log returns of HINDUNILVR.NS stock and generate forecasts for 500 periods (approximately two years) into the future.

Analysis:

Model Fitting: The code employs the arima function to fit a specific ARIMA(0,0,1) model to the return series. The model structure implies no autoregressive terms (AR) and a moving average (MA) term of order 1, suggesting a short-term dependency on past errors.

Model Output: The model coefficients reveal a negative MA1 coefficient (-0.0663) and a small but positive intercept (5e-04), representing a non-zero mean. The model's AIC value (-8323.95) provides a measure of model fit, with lower values generally preferred.

Forecasting: The forecast function utilizes the fitted model to generate forecasts for the next 500 periods.

Plot: The plot displays the original time series of daily returns along with the forecasted values.

Implication: The ARIMA(0, 0, 1) model is fitted to the historical daily returns of HUL stock, providing insights into the underlying patterns. The generated forecast can be used for future predictions, and the plot visually represents the model's performance.

Note: Interpretation of coefficients and model evaluation details may require further analysis based on the specific context of the financial data.

```{r}

#Autocorrelation test
# Ljung-Box Test for Autocorrelation
lb_test_ds_A = Box.test(arma13$residuals); lb_test_ds_A
#After this no autocorrelation exists


```

Objective: To assess the presence of autocorrelation in the residuals of the fitted ARIMA(0,0,1) model (arma13) for the daily log returns of HINDUNILVR.NS stock.

Analysis: The code utilizes the Box.test function to conduct the Ljung-Box test on the residuals of the fitted ARIMA model.

Interpretation: The output reveals a chi-squared statistic of 0.0063713 with a corresponding p-value of 0.9364. Since the p-value is greater than the typical significance level of 0.05, we fail to reject the null hypothesis of no autocorrelation in the model's residuals. This suggests that no statistically significant autocorrelation is present in the residuals after fitting the ARIMA(0,0,1) model.

Implications: The absence of significant autocorrelation in the residuals is a desirable outcome, as it indicates the model has effectively captured the underlying structure of the data and the residuals represent "white noise." This satisfies a key assumption of many time series models, including ARIMA, and improves the reliability and interpretability of the model results.

```{r}
# Test for Volatility Clustering or Heteroskedasticity: Box Test 
stk_ret_sq = arma13$residuals^2 # Return Variance (Since Mean Returns is approx. 0)
plot(stk_ret_sq)
stk_ret_sq_box_test = Box.test(stk_ret_sq, lag = 11) # H0: Return Variance Series is Not Serially Correlated
stk_ret_sq_box_test # Inference : Return Variance Series is Heteroskedastic (Has Volatility Clustering)

# Test for Volatility Clustering or Heteroskedasticity: ARCH Test
stk_ret_arch_test = ArchTest(arma13$residuals, lags = 11) # H0: No ARCH Effects
stk_ret_arch_test # Inference : Return Series is Heteroskedastic (Has Volatility Clustering)

```

Objective: To test for the presence of volatility clustering or heteroskedasticity in the residuals of the fitted ARIMA(0,0,1) model for the daily log returns of HINDUNILVR.NS stock.

Output Interpretation: Box Test: The p-value is extremely small (\< 2.2e-16), decisively leading to the rejection of the null hypothesis of no autocorrelation in the squared residuals.

This strongly suggests heteroskedasticity and volatility clustering in the residuals, meaning periods of high volatility tend to cluster together, as do periods of low volatility.

ARCH Test: The p-value is again extremely small (\< 2.2e-16), providing robust evidence to reject the null hypothesis of no ARCH effects.

This reinforces the presence of heteroskedasticity in the residuals, confirming that their variance is not constant but rather time-varying.

Implications: The presence of volatility clustering in the residuals violates a key assumption of traditional ARIMA models, which can lead to unreliable forecasts and underestimated risk. The identified heteroskedasticity necessitates the use of models that explicitly account for changing volatility, such as GARCH (Generalized Autoregressive Conditional Heteroskedasticity) models.

```{r}

#Garch model
garch_model1 = ugarchspec(variance.model = list(model = 'sGARCH', garchOrder = c(1,1)), mean.model = list(armaOrder = c(0,1), include.mean = TRUE))
nse_ret_garch1 = ugarchfit(garch_model1, data = arma13$residuals); nse_ret_garch1

garch_model2 = ugarchspec(variance.model = list(model = 'sGARCH', garchOrder = c(1,1)), mean.model = list(armaOrder = c(0,1), include.mean = FALSE))
nse_ret_garch2 = ugarchfit(garch_model2, data = arma13$residuals); nse_ret_garch2

# Test for Volatility Clustering or Heteroskedasticity: ARCH Test
gar_resd = residuals(nse_ret_garch2)^2
stk_ret_arch_test1 = ArchTest(gar_resd, lags = 1) # H0: No ARCH Effects
stk_ret_arch_test1 # Inference : Return Series is Heteroskedastic (Has Volatility Clustering)

```

Objective: To model the time-varying volatility of the residuals from the ARIMA(0,0,1) model of HINDUNILVR.NS stock returns using GARCH models. To test for the presence of volatility clustering in the residuals, even after GARCH modeling.

Analysis: Fitting GARCH Models: Two GARCH models were fitted to the residuals of the ARIMA(0,0,1) model: GARCH Model 1: sGARCH(1,1) model with ARFIMA(0,0,0) mean. GARCH Model 2: sGARCH(1,1) model with ARFIMA(0,0,1) mean.

ARCH Test on Squared Residuals: An ARCH test was performed on the squared residuals from both GARCH models to further check for residual volatility clustering.

Results:

GARCH Model 1:

Optimal Parameters: mu (Mean): -0.000034 (not significant) omega: 0.000013 alpha1: 0.083537 beta1: 0.846827 Log likelihood: 4312.848 Weighted Ljung-Box Tests: No significant autocorrelation in standardized residuals or squared residuals. Weighted ARCH LM Tests: No evidence of ARCH effects.

GARCH Model 2: Optimal Parameters: ma1: 0.056582 (marginally significant) omega: 0.000013 alpha1: 0.082117 beta1: 0.849888 Log likelihood: 4314.746 (slightly higher than Model 1) Weighted Ljung-Box Tests: No significant autocorrelation in standardized residuals or squared residuals. Weighted ARCH LM Tests: No evidence of ARCH effects. ARCH Test on Squared Residuals:

Diagnostic Tests:

Ljung-Box Test on both standardized residuals and squared residuals show no statistically significant autocorrelation at the 5% significance level (p-values \> 0.05), suggesting no remaining serial dependence in the residuals after fitting the GARCH model.

Weighted ARCH LM Tests also fail to reject the null hypothesis of no ARCH effects at the 5% significance level (p-values \> 0.05), implying no evidence of conditional heteroskedasticity (volatility clustering) in the residuals. Log-Likelihood:

The model achieves a log-likelihood of 4314.748, which reflects the goodness-of-fit of the model.

Chi-squared statistic: 32.718 p-value: 1.065e-08 (highly significant)

Inference: Both GARCH models effectively captured the time-varying volatility of the residuals. However, the ARCH test on squared residuals from the best-fitting model (GARCH Model 2) still indicates strong evidence of volatility clustering.

```{r}

# GARCH Forecast
stk_ret_garch_forecast1 = ugarchforecast(stk_ret_garch, n.ahead = 50); stk_ret_garch_forecast1

```

Objective: To analyze the forecasts generated by the fitted GARCH model (sGARCH(1,1)) for the daily log returns of HINDUNILVR.NS stock.

Output: The provided code snippet showcases the first 10 and last 5 entries of the 50-day forecast generated by the ugarchforecast function in R. The output displays the following information for each forecasted period:

T+i: Denotes the forecasted day, where T represents the last day of the in-sample data (December 29, 2023). Series: The forecasted log return on day T+i. Sigma: The forecasted conditional standard deviation (volatility) on day T+i.

Interpretation: The model predicts point forecasts for the log returns, represented by the "Series" values. These values provide an estimate of the expected log return on each future day. The "Sigma" values represent the forecasted volatility, indicating the model's estimate of the standard deviation of the log returns on each day. Higher sigma values suggest higher expected volatility, and vice versa.

Important Considerations: GARCH model forecasts are conditional forecasts, meaning they are based on the information available at the time of the forecast (December 29, 2023, in this case). Therefore, they do not account for any future events that might significantly impact the stock returns.

The forecasts are inherently uncertain, and the model provides confidence intervals around the point forecasts to quantify this uncertainty. These intervals are not shown in the provided output, but they are crucial for understanding the range of plausible future outcomes.

```{r}
plot(stk_ret_garch_forecast1)

```
